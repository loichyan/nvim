#!/usr/bin/env bash
set -e

# Skip rebasing/merging/cherry-picking
if [[ -d "$GIT_DIR/rebase-apply" || -d "$GIT_DIR/rebase-merge" ||
	-f "$GIT_DIR/MERGE_HEAD" || -f "$GIT_DIR/CHERRY_PICK_HEAD" ]]; then exit; fi

# Generate a random token
head=$(git rev-parse --short HEAD)
date=$(date -u +%s)
token=$((date * RANDOM * 0x$head))
token=$(printf %x "$token")

# Update the cache token
cat <<-LUA >lua/meowim/cache_token.lua
	-- This file is @generated by Git hooks. Do not modify it directly.
	return "$token"
LUA
git add lua/meowim/cache_token.lua
